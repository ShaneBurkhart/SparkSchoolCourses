<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>7.3 Hiding Tweet Edit Link | Shane Burkhart</title>
<meta name="viewport" content="width=device-width">

<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Serif:400,700" rel="stylesheet" type="text/css">

<!-- Custom CSS -->
<link rel="stylesheet" href="/assets/css/application.css">

    </head>
    <body>
        <header>
    <div class="container">
        <nav class="pull-left">
            <a id="site-logo">Spark School</a>
        </nav>
        
        <h3 id="section-name" class="pull-right">Day 7: Restrict Updating And Deleting Tweets</h3>
        
    </div>
</header>

        <main class="container">
            <article>
                <h1>7.3 Hiding Tweet Edit Link</h1>
                <h4>Table Of Contents</h4>

<ul>
<li><a href="/courses/twitter-clone/7/1">7.1 Saving Created Tweets In Cookies</a></li>
<li><a href="/courses/twitter-clone/7/2">7.2 Creating User Authentication Middleware</a></li>
<li><strong>7.3 Hiding Tweet Edit Link</strong></li>
</ul>

<p>In the last lesson, we implemented our middleware to restrict users from accessing tweets they didn&#39;t create.  In this lesson, we are going to remove the edit tweet link for tweets that the user didn&#39;t create.</p>

<p>The edit tweet links are rendered on the homepage route so we need to check if each tweet is editable there.  We are going to add an &quot;isEditable&quot; attribute to each tweet object in our existing loop.</p>

<p>Before we can do that, we need to get our &quot;tweets_created&quot; cookie and save it to a variable.  We are going to use the &quot;or&quot; operator again to make sure the &quot;tweetsCreated&quot; variable is an array.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// app.js</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="s1">'SELECT * FROM Tweets ORDER BY created_at DESC'</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">tweetsCreated</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">cookies</span><span class="p">.</span><span class="nx">tweets_created</span> <span class="o">||</span> <span class="p">[];</span>

  <span class="nx">connection</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">results</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">tweet</span> <span class="o">=</span> <span class="nx">results</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="nx">tweet</span><span class="p">.</span><span class="nx">time_from_now</span> <span class="o">=</span> <span class="nx">moment</span><span class="p">(</span><span class="nx">tweet</span><span class="p">.</span><span class="nx">created_at</span><span class="p">).</span><span class="nx">fromNow</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">'tweets'</span><span class="p">,</span> <span class="p">{</span> <span class="na">tweets</span><span class="p">:</span> <span class="nx">results</span> <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p>We already have a loop that is going through the tweets that are going to be rendered, so let&#39;s use that to check if each tweet is editable.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// app.js</span>
<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">results</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">tweet</span> <span class="o">=</span> <span class="nx">results</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

  <span class="nx">tweet</span><span class="p">.</span><span class="nx">time_from_now</span> <span class="o">=</span> <span class="nx">moment</span><span class="p">(</span><span class="nx">tweet</span><span class="p">.</span><span class="nx">created_at</span><span class="p">).</span><span class="nx">fromNow</span><span class="p">();</span>
  <span class="nx">tweet</span><span class="p">.</span><span class="nx">isEditable</span> <span class="o">=</span> <span class="nx">tweetsCreated</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">tweet</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>We are setting the &quot;isEditable&quot; attribute to the return value of &quot;includes&quot;.  If the id is included in created tweets then it is editable, if it&#39;s not, then the user can&#39;t edit the tweet.</p>

<p>We have the &quot;isEditable&quot; attribute on each tweet, so let&#39;s go to our &quot;_tweet.ejs&quot; partial and add a check for &quot;isEditable.</p>
<div class="highlight"><pre><code class="language-ejs" data-lang="ejs"><span class="c">&lt;!-- views/_tweet.ejs --&gt;</span>
<span class="nt">&lt;article</span> <span class="na">class=</span><span class="s">"tweet"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"http://twitter.com/&lt;%= tweet.handle %&gt;"</span><span class="nt">&gt;</span>@<span class="k">&lt;%= </span><span class="nx">tweet</span><span class="p">.</span><span class="nx">handle</span><span class="k"> %&gt;</span><span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"light-grey"</span><span class="nt">&gt;</span> - <span class="k">&lt;%= </span><span class="nx">tweet</span><span class="p">.</span><span class="nx">time_from_now</span><span class="k"> %&gt;</span><span class="nt">&lt;/span&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span><span class="k">&lt;%= </span><span class="nx">tweet</span><span class="p">.</span><span class="nx">body</span><span class="k"> %&gt;</span><span class="nt">&lt;/p&gt;</span>
  <span class="k">&lt;% if</span><span class="p">(</span><span class="nx">tweet</span><span class="p">.</span><span class="nx">isEditable</span><span class="p">)</span> <span class="p">{</span><span class="k"> %&gt;</span>
    <span class="nt">&lt;p&gt;&lt;a</span> <span class="na">href=</span><span class="s">"/tweets/&lt;%= tweet.id %&gt;/edit"</span><span class="nt">&gt;</span>Edit<span class="nt">&lt;/a&gt;&lt;/p&gt;</span>
  <span class="k">&lt;% </span><span class="p">}</span><span class="k"> %&gt;</span>
<span class="nt">&lt;/article&gt;</span>
</code></pre></div>
<p>We are adding an &quot;if&quot; statement in EJS tags that checks the &quot;isEditable&quot; value on the tweet and renders the edit tweet link if it is editable.  If you restart your web server and visit your homepage, tweets that were created before cookies were added should not have an edit link.</p>

<p><img src="https://s3.amazonaws.com/spark-school/courses/twitter-clone/7/7-3-hidden-edit-links.png" alt=""></p>

<p>That concludes the Twitter clone course.  At the start of this course, you started with minimal to no knowledge and in 7 days, you learned the basics of building a web app.  With the knowledge from this course, you can now start building your own CRUD apps.</p>

<p>There is still a lot of learning to be done, but now you have a solid understanding of the basic concepts that go into building a web app.  Everything else you&#39;ll learn is simply adding complexity to what we have and figuring out how to solve the problems you come across.</p>

<p>I&#39;m really excited that you made it all the way through the course and would love to know what you think.  Email me at shane@trysparkschool.com to let me know what you thought of the course.  I would appreciate any feedback and if you are interested, I can help point you in the right direction to continue your education.</p>

<p>Thanks for taking the course and I hope to hear from you soon!</p>

                
                <div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//spark-school.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


            </article>
        </main>
        <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-85659117-1', 'auto');
  ga('send', 'pageview');
</script>

    </body>
</html>
