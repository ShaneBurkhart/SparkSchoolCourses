<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>4.2 Reading The Tweet From The Database | Spark School</title>
<meta name="viewport" content="width=device-width">

<link href="https://fonts.googleapis.com/css?family=Open+Sans:700,700italic,400,400italic,300,300italic" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=PT+Serif:400,700" rel="stylesheet" type="text/css">

<!-- Custom CSS -->
<link rel="stylesheet" href="/assets/css/application.css">

        <!-- Facebook Pixel Code -->
<script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '327777587588900'); // Insert your pixel ID here.
fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" style="display:none"
src="https://www.facebook.com/tr?id=327777587588900&ev=PageView&noscript=1"
/></noscript>
<!-- DO NOT MODIFY -->
<!-- End Facebook Pixel Code -->

    </head>
    <body>
        <header>
    <div class="container">
        <nav class="pull-left">
            <a href="/" id="site-logo">Spark School</a>
        </nav>
        
            <h3 id="section-name" class="pull-right">Day 4: Showing Tweets</h3>
        
    </div>
</header>

        <main class="container">
            <article>
                <h1>4.2 Reading The Tweet From The Database</h1>
                <h4>Table Of Contents</h4>

<ul>
<li><a href="/courses/twitter-clone/4/1">4.1 Creating A Tweet In HTML/CSS</a></li>
<li><strong>4.2 Reading The Tweet From The Database</strong></li>
<li><a href="/courses/twitter-clone/4/3">4.3 Rendering Tweets On Our Page</a></li>
</ul>

<p>Our page now has a static tweet, but we still need to get our tweets from our database and pass them to our &quot;tweet.ejs&quot; template file so it can render them.</p>

<p>If you remember from day 3, we&#39;ve been using a SELECT query to see the contents of our Tweet table.  The query we have been using is one of the simplest forms of the SELECT query and let&#39;s go over that now.</p>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="c1">-- SQL Example</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">Tweets</span><span class="p">;</span>
</code></pre></div>
<p>SELECT queries allow us to read data from the database and start with the SELECT keyword.  After that, we define what columns we want to get from the database.  The &quot;*&quot; says get all columns.  If we only wanted the id and body columns, we could do the following.  We separate the column names by commas.</p>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="c1">-- SQL Example</span>
<span class="k">SELECT</span> <span class="n">id</span><span class="p">,</span> <span class="n">body</span> <span class="k">FROM</span> <span class="n">Tweets</span><span class="p">;</span>
</code></pre></div>
<p>After defining the columns we want, we put the FROM keyword followed by the table name that we want to get our data from.  Our table is named &quot;Tweets&quot; so we are going to get data from the Tweets table.</p>

<p>As I mentioned, this is the simplest form of the SELECT query and it gets all rows and columns in our Tweets table.  Since we want to order them by created_at, let&#39;s add the ORDER BY keyword to the end of our query.</p>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="c1">-- SQL Example</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">Tweets</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">created_at</span> <span class="k">DESC</span><span class="p">;</span>
</code></pre></div>
<p>The ORDER BY section usually goes at the end of a query and lets us order our data by a column.  After the ORDER BY keyword, we give the name of the column we want to order by.  After the column name, we either put ASC to sort in ascending order or DESC for descending order.  We are ordering by the &quot;created_at&quot; column and want to sort them in DESC order since we want the most recently created to come first.  This will be the query we use in our homepage route.</p>

<p>Let&#39;s execute this query in our homepage &quot;/&quot; route like we did in our create tweet route.  We&#39;ll also move the line that renders the &quot;tweets.ejs&quot; file to inside the query callback since the template will need the tweets from the query.  This time when we call the &quot;query&quot; method, we won&#39;t have any query parameters to pass.  Just the query and the callback.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// app.js</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="s1">'SELECT * FROM Tweets ORDER BY created_at DESC'</span><span class="p">;</span>

  <span class="nx">connection</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">'tweets'</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p>I set the query to a variable again since it&#39;s easier to read.  If you ever have code that is hard to read, it is usually a good idea to restructure how you are doing it so it&#39;s easier to read in the future.</p>

<p>We&#39;re now getting tweets, but as always, we need to check for errors and print them if they exist.  We still want to render our homepage if there is a query error so there&#39;s no need for the &quot;return&quot; keyword.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// app.js</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="s1">'SELECT * FROM Tweets ORDER BY created_at DESC'</span><span class="p">;</span>

  <span class="nx">connection</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">'tweets'</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p>The second parameter to the query callback contains the query results and we are naming that parameter&quot;results&quot;.  This is an array (list) of rows from our database.  We can run through these with a thing called a loop.  Loops let us execute a block of code over and over until we tell it to stop.  The loop we are going to use is the &quot;for&quot; loop.  I&#39;ll give an example and then explain what&#39;s going on.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Javascript Example</span>
<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>For loops start with the &quot;for&quot; keyword followed by parenthesis that tell the loop how to execute.  After the parenthesis, we have curly brackets that contain the code block that will run on each iteration of the loop.</p>

<p>Inside the parenthesis, there are three parts separated by semicolons.  The first section gets executed before the loop executes for the first time.  In the above &quot;for&quot; loop, we are setting the variable &quot;i&quot; to the value 0.</p>

<p>The next section in the parenthesis is the test condition for whether the loop should run.  If it returns true, then the loop will execute.  Ours is checking if the &quot;i&quot; variable is less than 4.  If &quot;i&quot; is less than 4, the loop&#39;s code block will be executed and if &quot;i&quot; is 4 or greater, the loop stops and code execution continues under the for loop.</p>

<p>The third section in the parenthesis executes after every iteration.  Ours has the code &quot;i++&quot; which is incrementing the &quot;i&quot; variable by 1.  This is short for &quot;i = i + 1;&quot;.</p>

<p>Based on what I just said, the for loop will print the number 0 to 3 and then stop execution.  If this doesn&#39;t make sense, you can walk through it.  On initialization, &quot;i&quot; gets set to zero.  The test condition is check and &quot;i&quot; is less than 4 so we execute the code block.  Our code is printing the variable &quot;i&quot; so it will print 0 on the first iteration.  After the first iteration, the third section in the parenthesis increments &quot;i&quot; so it will be 1 on the second iteration.  This pattern continues until the test condition is false.  That happens when &quot;i&quot; is 4 and the for loop will stop.</p>

<p>Let&#39;s use a for loop to go through our results.  I mentioned that our results parameter is an array of rows returned.  Arrays have a &quot;length&quot; property that will tell us how many items there are in the array.  We use the dot notation on our array as if we were getting the &quot;length&quot; value from an object.  The following will return how many results are in our array.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Javascript Example</span>
<span class="nx">results</span><span class="p">.</span><span class="nx">length</span>
</code></pre></div>
<p>We can use this value in our for loop&#39;s test condition to loop through our results.  Let&#39;s write a for loop that loop through all of our results and prints them.  We&#39;ll put this after our error check so we can see the results that are returned.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// app.js</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="s1">'SELECT * FROM Tweets ORDER BY created_at DESC'</span><span class="p">;</span>

  <span class="nx">connection</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">results</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">results</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">'tweets'</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p>Since the first item in an array has an index of 0, we check if &quot;i&quot; is less than the length of the array.</p>

<p>Assuming you inserted Tweets into your database earlier, you can restart your web server and load the homepage <a href="http://127.0.0.1:8080/">http://127.0.0.1:8080/</a> to see our tweets get printed to our terminal.</p>

<p><img src="https://s3.amazonaws.com/spark-school/courses/twitter-clone/4/select-tweets-query-results.png" alt=""></p>

<p>As you can see, each row is an object containing the data for each tweet.  We&#39;ll need the for loop in our next lesson so we&#39;re going to leave it there for now.  I more wanted to show you what was returned by our query.</p>

<p>In the next lesson, we&#39;ll be passing these tweets to our &quot;tweets.ejs&quot; template and rendering them to the page.</p>

<h3>Final Code</h3>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// app.js</span>
<span class="s1">'use strict'</span>

<span class="kd">var</span> <span class="nx">mysql</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'mysql'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">bodyParser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'body-parser'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">mysql</span><span class="p">.</span><span class="nx">createConnection</span><span class="p">({</span>
  <span class="na">host</span><span class="p">:</span> <span class="s1">'127.0.0.1'</span><span class="p">,</span>
  <span class="na">user</span><span class="p">:</span> <span class="s1">'vagrant'</span><span class="p">,</span>
  <span class="na">password</span><span class="p">:</span> <span class="s1">''</span><span class="p">,</span>
  <span class="na">database</span><span class="p">:</span> <span class="s1">'twitter'</span>
<span class="p">});</span>

<span class="nx">connection</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Connected to the database.'</span><span class="p">);</span>

  <span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Web server listening on port 8080!'</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'views'</span><span class="p">,</span> <span class="s1">'./views'</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'view engine'</span><span class="p">,</span> <span class="s1">'ejs'</span><span class="p">);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="s1">'./public'</span><span class="p">));</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nx">urlencoded</span><span class="p">({</span> <span class="na">extended</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}));</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="s1">'SELECT * FROM Tweets ORDER BY created_at DESC'</span><span class="p">;</span>

  <span class="nx">connection</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">results</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">results</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">'tweets'</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">'/tweets/create'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="s1">'INSERT INTO Tweets(handle, body) VALUES(?, ?)'</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">handle</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">handle</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">body</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>

  <span class="nx">connection</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="p">[</span><span class="nx">handle</span><span class="p">,</span> <span class="nx">body</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">'/'</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
                
                    <p class="text-center">
                        <a href="/courses/twitter-clone/4/3" class="next-lesson-button">
                            CLICK HERE TO GO TO THE NEXT LESSON
                        </a>
                    </p>
                
                
                    <div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//spark-school.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


                
            </article>
        </main>
        <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-85659117-1', 'auto');
  ga('send', 'pageview');
</script>

        <script type="text/javascript">
	var trackcmp_email = '';
	var trackcmp = document.createElement("script");
	trackcmp.async = true;
	trackcmp.type = 'text/javascript';
	trackcmp.src = '//trackcmp.net/visit?actid=649064395&e='+encodeURIComponent(trackcmp_email)+'&r='+encodeURIComponent(document.referrer)+'&u='+encodeURIComponent(window.location.href);
	var trackcmp_s = document.getElementsByTagName("script");
	if (trackcmp_s.length) {
		trackcmp_s[0].parentNode.appendChild(trackcmp);
	} else {
		var trackcmp_h = document.getElementsByTagName("head");
		trackcmp_h.length && trackcmp_h[0].appendChild(trackcmp);
	}
</script>

    </body>
</html>
