<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>4.3 Rendering Tweets On Our Page | Shane Burkhart</title>
<meta name="viewport" content="width=device-width">

<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Serif:400,700" rel="stylesheet" type="text/css">

<!-- Custom CSS -->
<link rel="stylesheet" href="/assets/css/application.css">

    </head>
    <body>
        <header>
    <div class="container">
        <nav class="pull-left">
            <a id="site-logo">Spark School</a>
        </nav>
        
        <h3 id="section-name" class="pull-right">Day 4: Showing Tweets</h3>
        
    </div>
</header>

        <main class="container">
            <article>
                <h1>4.3 Rendering Tweets On Our Page</h1>
                <h4>Table Of Contents</h4>

<ul>
<li><a href="/courses/twitter-clone/4/1">4.1 Creating A Tweet In HTML/CSS</a></li>
<li><a href="/courses/twitter-clone/4/2">4.2 Reading The Tweet From The Database</a></li>
<li><strong>4.3 Rendering Tweets On Our Page</strong></li>
</ul>

<p>In the last lesson, we got our tweets from the database and saw how we can loop through them to get each tweet.  Now, let&#39;s pass these to our template.</p>

<p>The “render” method we call at the end of our query callback only specifies the template we want to render.  There is a second optional parameter that takes an object that is passed to our template file.  We can define whatever values we want to pass to our template.  Let&#39;s add that now and assign our “results” parameter to the “tweets” key on our data object.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// app.js</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="s1">'SELECT * FROM Tweets ORDER BY created_at DESC'</span><span class="p">;</span>

  <span class="nx">connection</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">results</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">results</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">'tweets'</span><span class="p">,</span> <span class="p">{</span> <span class="na">tweets</span><span class="p">:</span> <span class="nx">results</span> <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p>Now inside our “tweets.ejs” template, we can reference the variable “tweets” to get our results array.  Let&#39;s go into our “tweets.ejs” template and loop through our results much like we did in our homepage route.</p>

<p>EJS is a template engine that allows us to run javascript code in HTML files.  So an EJS file is really just an HTML file that has a special syntax that lets us run javascript code in our template. I&#39;m going to write a for loop in EJS below and explain it after.</p>
<div class="highlight"><pre><code class="language-ejs" data-lang="ejs"><span class="c">&lt;!-- EJS Example --&gt;</span>
<span class="k">&lt;% for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">tweets</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span><span class="k"> %&gt;</span>
  <span class="nt">&lt;p&gt;</span><span class="k">&lt;%= </span><span class="nx">tweets</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">body</span><span class="k"> %&gt;</span><span class="nt">&lt;/p&gt;</span>
<span class="k">&lt;% </span><span class="p">}</span><span class="k"> %&gt;</span>
</code></pre></div>
<p>The above code has a lot of symbols, but it&#39;s pretty easy to break down.  To run javascript code in EJS files, we put our javascript between “&lt;%” and “%&gt;”.  The first line shows an example of how this works.  We define the start of our “for” loop block in EJS brackets.  We also close the “for” loop code block on the third line with the same brackets and a curly brace.  This looks just like our homepage route&#39;s loop, but we wrap the lines with EJS brackets.</p>

<p>Now every time this runs, the code and elements inside the for loop will be executed.  If we have 3 tweets, then you will see three paragraph tags appear.  Inside our paragraph element, we are outputting the tweet body.  Notice how this EJS tag starts with a “&lt;%=” instead of just “&lt;%”.  The equals sign tells EJS to output whatever was returned inside the tags.  So in our case, we are getting the tweet with the index “i” and getting its body.  The body will be put in each of the paragraph elements.</p>

<p>These are really the two main EJS tags you will use.  There are a few others but they are used far less frequently so we won&#39;t go over them.  If you want to know more, check out the EJS site.</p>

<p>Now we know how to run javascript in EJS files, so let&#39;s run through our tweets and output the tweets HTML for each tweet filled in with correct values.  The code will look a bit different since I formatted the first paragraph element (the one containing the handle) to be on multiple lines.  This doesn&#39;t change any behavior of our file, it just makes it easier to read.</p>
<div class="highlight"><pre><code class="language-ejs" data-lang="ejs"><span class="c">&lt;!-- views/tweets.ejs --&gt;</span>
<span class="nt">&lt;main&gt;</span>
  <span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">"tweet-form"</span> <span class="na">action=</span><span class="s">"/tweets/create"</span> <span class="na">method=</span><span class="s">"POST"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"tweet-form-handle"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"handle"</span> <span class="na">placeholder=</span><span class="s">"DonkkaShane"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;textarea</span> <span class="na">id=</span><span class="s">"tweet-form-body"</span> <span class="na">name=</span><span class="s">"body"</span> <span class="na">placeholder=</span><span class="s">"What's happening?"</span><span class="nt">&gt;&lt;/textarea&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"tweet-form-button"</span><span class="nt">&gt;</span>Tweet<span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;/form&gt;</span>
  <span class="k">&lt;% for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">tweets</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span><span class="k"> %&gt;</span>
    <span class="k">&lt;% </span><span class="kd">var</span> <span class="nx">tweet</span> <span class="o">=</span> <span class="nx">tweets</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span><span class="k"> %&gt;</span>
    <span class="nt">&lt;article</span> <span class="na">class=</span><span class="s">"tweet"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;p&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"http://twitter.com/&lt;%= tweet.handle %&gt;"</span><span class="nt">&gt;</span>@<span class="k">&lt;%= </span><span class="nx">tweet</span><span class="p">.</span><span class="nx">handle</span><span class="k"> %&gt;</span><span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"light-grey"</span><span class="nt">&gt;</span> - <span class="k">&lt;%= </span><span class="nx">tweet</span><span class="p">.</span><span class="nx">created_at</span><span class="k"> %&gt;</span><span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;/p&gt;</span>
      <span class="nt">&lt;p&gt;</span><span class="k">&lt;%= </span><span class="nx">tweet</span><span class="p">.</span><span class="nx">body</span><span class="k"> %&gt;</span><span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;/article&gt;</span>
  <span class="k">&lt;% </span><span class="p">}</span><span class="k"> %&gt;</span>
<span class="nt">&lt;/main&gt;</span>
</code></pre></div>
<p>All I did here was substitute the hardcoded handle, body and created_at values with EJS brackets outputting the appropriate values.  Since we would be getting “tweets[i]” a bunch, I saved this value to a variable called “tweets” at the beginning of each iteration.  We use the “tweet” variable to get each tweet&#39;s data.</p>

<p>Restart your server since we added the data object to our “render” method in “app.js”.  Load the homepage http://127.0.0.1:8080 and you should see your tweets rendered with their values.</p>

<p><img src="https://s3.amazonaws.com/spark-school/courses/twitter-clone/4/rendered-tweets.png" alt=""></p>

<p>Our tweets feed is finally coming to life, but that date is plain nasty.  We want to put it into a much easier to digest format such as “18 minutes ago”.  To do this, we are going to use a library called Moment.js.</p>

<p>Moment.js is an extremely useful library that makes working with dates really easy.  As we have with other libraries we need to install it for our project (--no-bin-links) for windows.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Terminal</span>
npm install moment --save
</code></pre></div>
<p>With that library installed, let&#39;s require it in our “app.js” file.  Put this under the rest of our “require” calls to keep things organized.</p>

<p>Moment.js is imported, so let&#39;s loop through our tweets and calculate the time from now for each tweet&#39;s “created_at” value.  We&#39;ll add this time from now value to each tweet object as “time_from_now”.  Our “for” loop in app.js will now look like the following.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// app.js</span>
<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">results</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">tweet</span> <span class="o">=</span> <span class="nx">results</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
  <span class="nx">tweet</span><span class="p">.</span><span class="nx">time_from_now</span> <span class="o">=</span> <span class="nx">moment</span><span class="p">(</span><span class="nx">tweet</span><span class="p">.</span><span class="nx">created_at</span><span class="p">).</span><span class="nx">fromNow</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>The first thing we are doing is getting the tweet and saving it to a variable called “tweet”.</p>

<p>Up until now, we have only used the dot notation to get values for keys on objects.  In javascript, you can also assign values to keys the same way you would a variable.  The second line in the for loop is setting the “time_from_now” key to the right side of the equals sign.</p>

<p>On the right side of the equals, we have our Moment.js code.  When importing Moment.js, we get a function that takes a date and returns a Moment.js date object.  The new Moment.js date has a lot of helper methods we can use to format and manipulate our date.  The method that will give us the time from now is the “fromNow” method.  This returns the date in a human friendly format like “18 minutes ago”</p>

<p>With our new value on each tweet, let&#39;s go back to our template and update our date to “time_from_now” instead of “created_at”.</p>
<div class="highlight"><pre><code class="language-ejs" data-lang="ejs"><span class="c">&lt;!-- views/tweets.ejs --&gt;</span>
<span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"http://twitter.com/&lt;%= tweet.handle %&gt;"</span><span class="nt">&gt;</span>@<span class="k">&lt;%= </span><span class="nx">tweet</span><span class="p">.</span><span class="nx">handle</span><span class="k"> %&gt;</span><span class="nt">&lt;/a&gt;</span>
  <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"light-grey"</span><span class="nt">&gt;</span> - <span class="k">&lt;%= </span><span class="nx">tweet</span><span class="p">.</span><span class="nx">time_from_now</span><span class="k"> %&gt;</span><span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;/p&gt;</span>
</code></pre></div>
<p>Restart your server and refresh the homepage http://127.0.0.1:8080.  You should now see an easy to read date.</p>

<p><img src="https://s3.amazonaws.com/spark-school/courses/twitter-clone/4/human-readable-time-from-now.png" alt=""></p>

<p>We can now create tweets and see them get added to the page.  Try adding a tweet with our form and you should see it get added to the top of our tweets feed.</p>

<p>Today, we went over the “R” (Read) part of CRUD.  So far we can create tweets with our form and render tweets on our homepage.  This is really exciting, because our app is becoming interactive.  In day 5, we will go over the “U” (Update) and how we can edit these tweets after they are created.</p>

                
                <div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//spark-school.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


                <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-85659117-1', 'auto');
  ga('send', 'pageview');
</script>

            </article>
        </main>
    </body>
</html>
